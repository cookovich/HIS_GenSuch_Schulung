<?xml version="1.0" encoding="UTF-8"?>
<root  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="../../../searchConfig.xsd">

    <entity name="Application">
        
        <groupResult />

        <pageTitle>de.his.javang.search.applicant.titel</pageTitle>
        <tableTitle>de.his.javang.found.applicant</tableTitle>

		<iconTitleColumns>Application.applicant.person.surname</iconTitleColumns>

        <defaultSortCriteria>
        	CONCAT(Application.applicant.person.surname,', ',Application.applicant.person.firstname),
            Application.term.year,
            Application.term.termTypeValue.defaulttext
        </defaultSortCriteria>

        <selectColumns>
        	<column label="psv.Person.name">
        		CONCAT(Application.applicant.person.surname,', ',Application.applicant.person.firstname)
        	</column>
            <column label="de.his.javang.applicant.id">
                Application.applicant.applicantnumber
            </column>
            <column label="sul.zul.Bewerber.bewerbung.periodOfStudy.mesterartmester">
                Application.term.termTypeValue.defaulttext
            </column>
            <column label="sul.zul.Bewerber.bewerbung.jahr">
                Application.term.year
            </column>
            <column label="cs.sys.applog.sul.zul.bewerbung.RequestSubject">
                Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.defaulttext
            </column>
            <column label="sul.zul.bewerbung.RequestSubject.studysemesterRequested">
                Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.studysemesterRequested
            </column>
            <column label="cm.stu.transfer_app.studysemesterAdmitted">
                Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.studysemesterAdmitted
            </column>
            <column label="psv.Person.nationalityId">
                [CountryValue:nationality].defaulttext
            </column>
        </selectColumns>

        <hiddenSelectColumns>
            <column name="personId">Application.applicant.person.id</column>
            <column name="bewerberId">Application.applicant.id</column>
            <column name="bewerbungId">Application.id</column>
            <column name="termTypeId">Application.term.termTypeValue.id</column>
            <column name="year">Application.term.year</column>
        </hiddenSelectColumns>

		<staticSearchCriteria>
			<criteria value="65|81">  <!-- auch Doctoranden mit einer Bewerbung #213955-->
				Application.applicant.person.roles{CURRENT_VERSIONS}.role.hiskeyId
			</criteria>
			<criteria value="101|102|8|6"><!-- Immatrikulation beantragt | Immatrikulationsantrag in Bearbeitung | zugelassen | Zulassungsangebot liegt vor-->
				<!-- Application.requestgroups.requests.requestStatus.hiskeyId -->
				Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.requestSubjectStatus.hiskeyId
			</criteria>	
			<criteria value="#{flowScope.personId}">
				Application.applicant.person.id
			</criteria>
		</staticSearchCriteria>
		
        <searchCriteria>
            <group label="de.his.javang.persoenlicheDatenSuchen">
                <criteria label="de.his.javang.applicant.id" quickSearchCriterion="true">
                    Application.applicant.applicantnumber
                </criteria>
                <criteria label="psv.Student.registrationnumber">
	                Application.applicant.person.student.registrationnumber
	            </criteria>
                <criteria label="psv.Person.surname" quickSearchCriterion="true">
                    Application.applicant.person.surname
                </criteria>
                <criteria label="psv.Person.firstname" quickSearchCriterion="true">
                    Application.applicant.person.firstname
                </criteria>
                <criteria label="psv.Person.nationalityId"
                    multipleSelect="true"
                    selectFrom="allCountries">
                    [CountryValue:nationality].id
                </criteria>
                <criteria label="cm.stu.Student.enrollmentdate"
                	inputType="DATE">
	                Application.applicant.person.student.enrollmentdate
	            </criteria>
            </group>
   			
			<!-- Einwilligungen -->
			<foreach items="${flowScope.allAgreementDefinitions}" var="definition">
				<group label="Einwilligungen ${valueServiceController.allPurposes[definition.purposeId].defaulttext}" context="agreementsPresentInFlowScope">
						<criteria label="${definition.defaulttext}" selectFrom="agreementController.getPeronalAgreementStatusForGenericSearchSelectFrom('${definition.definitionKey}')">
							[Person].personalAgreements{agreementDefinition.id=${definition.getId()}}.currentUpdate.status
						</criteria>
				</group>
			</foreach>
			
            <group label="de.his.javang.suchen.adressdaten">
				<criteria label="psv.Adresse.strasse">
					[Applicant].[Postaddress].street
				</criteria>
				<criteria label="psv.Adresse.postleitzahl">
					[Applicant].[Postaddress].postcode
				</criteria>
				<criteria label="psv.Adresse.ort">
					[Applicant].[Postaddress].city
				</criteria>
				<criteria label="psv.Adresse.land"
					multipleSelect="true"
					selectFrom="allCountries">
					[Applicant].[Postaddress].country.id
				</criteria>
			</group>
			<group label="de.his.javang.kontaktdaten">
				<criteria label="common.components.contactPerson.email">
					[Applicant].[EMail].eaddress
				</criteria>
				<criteria label="de.his.javang.emailWithSpecificAddressTag" 
					addToSelects="false"
					selectPathCritFrom="allAddresstags">
					Application.applicant.person.addresses{CLASS=EMail,addresstag.id=$}.eaddress
				</criteria>
				<criteria label="cs.psv.phone">
					[Applicant].[Phone].eaddress
				</criteria>
			</group>
			<group label="cm.stu.Student.search_term_status">
                <criteria label="de.his.javang.applicant.applicationStatus"
                    selectFrom="allApplicationStatus" quickSearchCriterion="true">
                    Application.applicationStatus.id
                </criteria>
                <criteria label="common.Term"					
					inputType="TERM"
					multipleSelect="true">
					Application.term
				</criteria>	
            	<criteria label="sul.zul.bewerbung.RequestSubject.studysemesterRequested">
                	Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.studysemesterRequested
            	</criteria>
            	<criteria label="cm.stu.transfer_app.studysemesterAdmitted">
                	Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.studysemesterAdmitted
            	</criteria>
			</group>
            <group label="de.his.javang.antraegeSuchen">
				<criteria label="cm.exa.CourseOfStudy.degree"
					multipleSelect="true"
					selectFrom="allInternalDegrees" quickSearchCriterion="true">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.degreeObj.currentVersions.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.subject"
					multipleSelect="true"
					selectFrom="allInternalSubjects" quickSearchCriterion="true">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.subjectObj.currentVersions.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.majorFieldOfStudy"
					multipleSelect="true"
					selectFrom="allMajorFieldOfStudies">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.majorFieldOfStudyObj.currentVersions.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.courseSpecialization"
					multipleSelect="true"
					selectFrom="allCourseSpecializations">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.courseSpecializationObj.currentVersions.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.subjectIndicator"
					multipleSelect="true"
					selectFrom="allSubjectIndicators">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.subjectIndicator.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.typeOfStudy"
					multipleSelect="true"
					selectFrom="allTypeOfStudies">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.typeOfStudy.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.placeOfStudies"
					multipleSelect="true"
					selectFrom="allPlaceOfStudies">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.placeOfStudies.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.formOfStudies"
					multipleSelect="true"
					selectFrom="allFormOfStudies">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.formOfStudies.id
				</criteria>
				<criteria label="cm.exa.CourseOfStudy.enrollment"
					multipleSelect="true"
					selectFrom="allEnrollments">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.enrollment.id
				</criteria>
				<criteria label="cm.stu.staff.tree.orgunit"
					selectFrom="orgunitController.getAllCurrentDepartments()"
					multipleSelect="true">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.orgunitObj.id
				</criteria>
				<criteria label="sul.zul.bewerbung.CourseOfStudy.examinationversion"
					selectFrom="allExaminationversions"
					multipleSelect="true">
					Application.requestgroups.requests.requestsubjectgroups.requestsubjectgroupRequestsubjects.requestSubject.courseOfStudy.examinationversion.id
				</criteria>
				<!-- <criteria label="cm.stu.DegreeProgramProgress.studysemester">
					Student.person.degreePrograms{belongsTo="STUDENT"}.progress.studysemester
				</criteria> -->
				
            </group>
            
                   <group label="cm.stu.fee.FeeInvoiceInfo">
               
               <criteria label="cm.stu.fee.reqmanagement.RequestToChangeFee.periodId"
				    addToSelects="false"
				    showNullItem="false"
                    multipleSelect="true"
                    showUnequalOption="false"
                    selectFrom="paymentStatusController.getAllFeePeriods()">
                    Application.applicant.person{JOINALIAS=Person_PersonBusinessPartner}:PersonBusinessPartner{REVERSEPATH=person}.salesInvoices.period.id
                </criteria>
                
                <criteria label="rm.fia.ledger.SalesInvoice.documentState"
                    addToSelects="false" 
                    multipleSelect="false"
                    showNullItem="false"
                    showUnequalOption="false"
                    selectFrom="paymentStatusController.getAllPaymentStatus(false, false, true)">
                    Application.applicant.person{JOINALIAS=Person_PersonBusinessPartner}:PersonBusinessPartner{REVERSEPATH=person}.salesInvoices.paymentInfo.unpaidAmount
                </criteria>
                
                <criteria label="rm.fia.accounts.PaymentInfo.paymentAmount"
                    addToSelects="false" 
                    showNullItem="false"
                    showUnequalOption="false">
                    Application.applicant.person{JOINALIAS=Person_PersonBusinessPartner}:PersonBusinessPartner{REVERSEPATH=person}.salesInvoices.invoiceLines.grossPrice
                </criteria>
                
 				<criteria label="cm.stu.fee.FeeInvoiced"
				    addToSelects="true"
				    multipleSelect="true"
				    showUnequalOption="false"
				    showNullItem="false"
				    selectFrom="feeInvoiceLineController.getAllFee()">
					Application.applicant.person{JOINALIAS=Person_PersonBusinessPartner}:PersonBusinessPartner{REVERSEPATH=person}.salesInvoices.invoiceLines.feeNode.parameterizedFee.fee.id
				</criteria>

               <criteria label="cm.stu.fee.FeeUnInvoiced"
				    addToSelects="false"
				    multipleSelect="false"
				    showUnequalOption="false"
				    showNullItem="false"
				    selectFrom="feeInvoiceLineController.getAllFee()">
					Application.applicant.person{JOINALIAS=Person_PersonBusinessPartner}:PersonBusinessPartner{REVERSEPATH=person}.salesInvoices.invoiceLines.feeNode.id
				</criteria>
			</group>
			
			<!-- Krankenversicherung -->
			<group label="cm.stu.enrollment.HealthInsurance">
				<criteria label="cm.stu.smv.participation"
					showNullItem="false" selectFrom="genericSearchController.getSelectFrom('0=Nein|1=Ja')">
					Applicant.person.personinfo.healthInsuranceSmvParticipation
				</criteria>
				<criteria label="psv.Personinfo.insurantStatusId"
					showNullItem="true" multipleSelect="true"
					selectFrom="allInsurantStatus">
					Applicant.person.personinfo.insurantStatus.id
				</criteria>
				<criteria label="psv.Personinfo.healthInsuranceNumber">
					Applicant.person.personinfo.healthInsuranceNumber
				</criteria>
				<criteria label="cm.stu.smv.insuranceConfirmation"
					showNullItem="true" multipleSelect="true"
					selectFrom="allHealthInsuranceConfirmationStatus">
					Applicant.person.personinfo.healthInsuranceConfirmationStatus.id
				</criteria>
				<criteria label="cm.stu.smv.lastCheck" inputType="DATE">
					Applicant.person.personinfo.healthInsuranceCheckdate
				</criteria>
				<criteria
					label="psv.Personinfo.healthInsuranceStandardCompanyNumber">
					Applicant.person.personinfo.healthInsurance.standardCompanyNumber
				</criteria>
				<criteria label="psv.Personinfo.healthInsuranceId"
					showNullItem="false" showUnequalOption="true" multipleSelect="true"
					selectFrom="stuSearchController.getAllByNameIncludeInvalid('HealthInsuranceValue')">
					Applicant.person.personinfo.healthInsurance.id
				</criteria>
			</group>
			
			<!-- Meldungen aus SMV -->
			<group label="cm.stu.smv.participation.notification" criteriaGroup="true">
				<criteria label="cm.stu.smv.smvNotification.assigndNotification"
					showNullItem="true" multipleSelect="true"
					selectFrom="allSmvReasonOfNotifications">
					Applicant.person{JOINALIAS=Person_SmvNotification}:SmvNotification{REVERSEPATH=person}.reason.id
				</criteria>
				<criteria label="cm.stu.smv.smvNotification.proposedNotification"
					showNullItem="true" multipleSelect="true"
					selectFrom="allSmvReasonOfNotifications">
					Applicant.person{JOINALIAS=Person_SmvNotificationAssignmentProposalListEntry}:SmvNotificationAssignmentProposalListEntry{REVERSEPATH=person}.notification.reason.id
				</criteria>
				<criteria label="cm.stu.smv.smvNotification.field.internalComment" 
						helptext="cm.stu.smv.smvNotification.field.internalComment:searchhelptext">
					Applicant.person{JOINALIAS=Person_SmvNotification}:SmvNotification{REVERSEPATH=person}.internalComment
				</criteria>
				<criteria label="cm.stu.smv.smvNotification.column.modifiedAt" inputType="DATE">
					Applicant.person.personinfo.healthInsuranceCheckdate
				</criteria>
			</group>
			    
        </searchCriteria>
		
    </entity>
</root>
